// Automatizovaný penetrační test backendu pomocí OWASP ZAP API (nebo ZAP CLI)
// Výsledky ukládá do reports/pentest_report.txt
// Pro reálný provoz doporučujeme spouštět v izolovaném prostředí!

const { execSync } = require('child_process');
const fs = require('fs');
const path = require('path');

const TARGET = process.env.PENTEST_TARGET || 'http://localhost:3001';
const REPORT_PATH = path.resolve(__dirname, '../reports/pentest_report.txt');

function runZapScan() {
  try {
    // ZAP musí být nainstalován a dostupný v PATH (nebo použijte docker)
    // Základní scan: zap-cli quick-scan --self-contained --start-options '-config api.disablekey=true' <target>
    const cmd = `zap-cli quick-scan --self-contained --start-options '-config api.disablekey=true' ${TARGET}`;
    const output = execSync(cmd, { encoding: 'utf8', stdio: 'pipe' });
    fs.writeFileSync(REPORT_PATH, output);
    console.log('Penetrační test dokončen. Výsledek uložen do:', REPORT_PATH);
  } catch (e) {
    fs.writeFileSync(REPORT_PATH, 'Penetrační test selhal:\n' + e.message);
    console.error('Penetrační test selhal:', e.message);
  }
}

if (require.main === module) {
  runZapScan();
}
